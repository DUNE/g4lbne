
This is an informal, code level, release note:

v3r0 : gemoetry complete, see LBNE doc 7922 for status. 

v3r0p4:

Sept 23 - 25: 
a. adjust the Z offset for Volume TargetHallAndHorn1 and Hron2Hall such
that the cooredinate MCZERO, drawing 8875.112-MD-363097, updated gy Jim Hylen, 
July 2013, is at Z = 0., G4 world coordinate system. This MCZero is the
"idealize" statring point of Horn1. 

b. Hor1n inner conductor geometry Re-adjust ( again) the ratio of equation 0
to equation 1 weights and cross-check the test ratio compatibility. If the 
geometry is not rescaled, the maximum length of target inside Horn1 is about
62.25 cm 

c. Minor upgrade in the SteepingAction for dumping information about Geantino
tracing. 

d. Installation of the Decay Pipe Snout and Beryllium window (Al frame, Al/Be
window.) And helium in the ~ 10 m. long snout. 

Sept 26-27:

e. Reinstallation of the Hadron calorimeter. Create a new buffer volume, size to
the 4 individual pieces that were daughter of the TOP volume received from MARS.
This volume (HadronAbsorberTop in G4lbne) is rotate with respect to the decay
pipe axis (beam axis), by the beam angle to reach South Dakota Homestake mine. 
These 4 daughter volumes are placed in HadronAbsorberTop, roated by +90 degree
around the Z axis, as the X-Axis in MARS is the vertical direction.  The volume
named PreM_sp is not centered on the beam line, is presumed to be a supporting
structure, and is indeed at negative Y in g4lbne. 

To be verified with visualization! 

We are not quite done: 

	- the premask entrance volume is currently shifted up by ~20 cm. This
	might be o.k., since the buffer volume is rotated, we'd like to have the
	entrance window shifted up, such the core is more or less centered on
	the beam axis. 

f. Fix severe bug in creating the directions and vertices of the protons 
in LBNEPrimaryGeneratorAction.  Confusion about beam spread in spatial position
vs beam divergence (emittances in x', y', which we currently don't have), caused
creating vertices with Nan... P.L. blurry code, no doubt.. 

Protons of 120 GeV now impinging on target, from a z-coordinate of -3.60, well
upstream of the target. .. 

Oct 1 2014

 Adding 4 corners to the target fins. Install new and improved version of 
 Hadron absorber via new GDML file. Scary error message from the GDML parser,
 and a 73 micron overlap. Need to check with visualization. Meanwhile, geantino
 reached the core of this new absorber, going 
 
 Oct 2 2014 
 
 Start installing the shielding blocks, all made of steel. They include the
 cooling pannels, where the density is a but overestimate, as the cooling tube
 are not yet implemented. Working on it.. But making a cvs commit now ..
 
 Review again the target dimensions, and remove some of the empty space. 
  
 Oct 3 2014 
 
 Finish the installation of the shielding blocks. One can remove them,
 optionally.  Allow for the capability of running with a different material for
 the inner conductor, for Horn1 and Horn2. Also allow for tweaking the thickness
 of the Beryllium cap at the end of the Helium container vessel. 
 
 Oct 6-8 2014 
 
 Add a command card to define the "length of target outside Horn1", by popular
 demand. Add a command data card to overwrite the radial safety margin between 
 the downstream end of the target and the inner conductor. 
 Review the way the target Helium container is misaligned. We now allow
 the upstream end to be misaligned with respect to the canister. 
 The slope between the virtual downstream/upstream end of the target
 is determined by the length of graphite + 10 cm, the approximate length
 reserved for the last alignment ring and the return cooling pipe. 
 
 Oct 14-15
 
 Modify the generation of the proton beam generation.  By default, we now starts
 at z = -3.6 m., using the Courant Snider parameters from the baseline beam
 design, by John Jonstone. The sigma of the beam is now 1.302 mm, as we are a
 bit upstream of the beam waste, for a 20 pi mm mr emittance at 120 GeV/c. 
 The typical angles are of the order of 20 to 40 micro-radians. 
 
 Also add ~250 m of rock downstream of the muon alcove and the (still absent)
 near detector geometry. This can be adjusted via the command card 
 /LBNE/det/LengthOfRockDownstr 
 
 Veryfied, that by default, the first vertical fin of the target starts at
 Z=-350.058 mm (the extra 58 microns is a long story, not worth worrying about).
 
<end changes contained in v3r0p4> 


v3r0p6:
 
Oct 28 2013

 a. Fix a bug in setting the spacing of the alignment ring: if the target is shorter than nominal, one should re-adjust the specing between these rings such that all 5 of them fit in the Helium containment vessel. But unveiled by Laura, Oct. 26 

 b. PLace a protection against anomalously small stept size (less then the Borh radius) in SteppinAction. Geant4 v4.9.6.p02 allows such step size, and goes into an infinite loop is some case (bug unveiled by John LoSecco, ~Oct 20 2013)  This is patch, not a clean resolution. It occurs only for neutron,  and very rarely for Kaon0L.  I suspect the cross-section for such neutron goes too large, triggering a reduction of the step length. Howeve,r a 2nd look into the geometr of the Horn1 Inner/outer transition is needed, as it happens always there. 

 c. Fix a critical typo in LBNEDownVolPlacements.cc :

diff -r1.1.2.28 LBNEDownstrVolPlacements.cc
287c287
<   fHorn1UpstrInnerRadsOuterUpstr[2] = fHorn1UpstrInnerRadsUpstr[2] + 0.118*in; 
---
>   fHorn1UpstrInnerRadsOuterUpstr[3] = fHorn1UpstrInnerRadsUpstr[2] + 0.118*in; 

  Note the index in the array holding the value of the outer radius at the upstream end of this conical section was mistyped. It should the inner radius plus the aluminum thickness. This volume was fairly short, only 1.06 cm long. In g4lbne v3r0p4, the outer radius was set to zero. Under Geant4  v4.9.4, this volume was skipped, apparently, as no transition from it's mother volume (Horn1IOTransCont) to Horn1IOTransInnerPart3 was actually detected with geantino. Since it is of relatively short length, a cursory look at the geantino intersection plots was not good enough. The faulty surface fits inside the mother volume just fine, and does not clash with any other surface. But the tracking could be problematic. it is very likely that a piece of the Horn1 inside conductor, located between z = 106 mm and 116 mm was just missing in g4lbne v3r0p4 (and v3r0p5). 
Our visualization campaign also missed it, because it was too short. The piece in question can be seen on drawing number 8875.112-MD-363097, ending at z ~ 3.3157.  It features an extra thickness for welding.

   Under Geant4 4.9.6.p02, while tracing particle that go in straight line, (neutron and kaon), Geant4 got confused, and failed catastrophically.. Fixing that index removed the naviagation errors, i.e., the detection of anomalously small step sizes. Over 100k PoT, not a single track has been lost due to this bug. I believe 
it will also fix the memory problem. I propose to leave the patch in LBNESteppingAction as is, as we may still have problem in the geometry, and we do not want to have the G4 tracking failing that catastrophically. Also, we now have in place an algorithm to check on the memory size, at every step, should it becomes necessary. 

</v3r0p6>

<v3r0p7>
 Oct 29 2013: 

   Thanks to Seongtae, two new small deficiency in the geometry have been discovered via carefull visualization.  Both have been fixed: 

    a. A section, ~15 mm long, of the target cooling tube was missing in the first target segment of the downstream target section (located inside the horn, at Z > 0.)
The pointer to the logical volume was not kept in memory, therefore deleted. The placement of the water was not done as well => no tube there. Kept the pointer, and let the water flow through that section. 

   b. The 4 target corners, around the target cooling tubes, were not defined for the last and first partial target segments, located around Z = 0. As you recall, in order to keep the Horn1 and upstream section of the target in different logical volume trees, which ultimately simplifies the navigation, the target is split into part, upstream of Horn1 and the portion which is in Horn1 (part of the Horn1 logical volume tree). Thus, there is one 20 mm target fin which is split into 2 parts.  For sake of simplicity and avoiding too many volumes, I skipped the creation of the 4 corners for that split target fin segment.  < 0.2% of graphite.. Negligible, but then out visualization looked funny, incomplete.. So, I put them in. 

   Checked with geantinos, need confirmation from visualization.. 

</v3r0p7>
 
<v3r0p8>
   
  Oct 30 2013. 

   a. Minor improvement to the calculation of the magnetic field map. John Losecco noticed that there was a small (~2 to 3 mm) shifts of the coordinate transform world -> Horn local in LBNEMagneticField, depending on the seed. This coordinate trasform was set based on the volume assignment and placement coordinates of the first track entering the Horn. While Geant4 guarantees that a sensitiv volume be crossed at it's exact boundary coordinates, the package simply guarantees that the integral over the field will computed with a specified accuracy. It does this by asking the field values at the entrance of the volume, but there is no warantee that it will do so within a specified accuracy.  So, run, to run, we could have fluctuation in the location of the Horn2 field, by up to a few mm. This coordinate transform for Horn1 was accurate to 20 microns (fixed shift). 

      So, setting up these coordinate transform at "Beam On" time, based on real tracks, dating from the time when the world reference frame was *not* pinned to Horn1 (and thereby Horn2, the way the longitudinal position of Horn2 was defined).  The coordinate system was later sanitized, but not the way the World -> local (and drawings ) was computed in the LBNEMagneticField.  This has been now corrected, these coordinates transforms are now defined in LBNEMagneticField constructor, from volume placement data (and surveyor data, that part was o.k.) 

   b. Turn off use of Courant Snider parameters when user specifies a beam sigma.

</v3r0p8>
 

 



 




